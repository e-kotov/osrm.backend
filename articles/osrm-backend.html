<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quick Start: Install OSRM and calculate routes • osrm.backend</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start: Install OSRM and calculate routes">
<!-- counter.dev analytics --><script data-goatcounter="https://jukadipos.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><!-- counter.dev analytics --><script src="https://cdn.counter.dev/script.js" data-id="7e3e8d31-9a84-48b0-a678-a00715236a90" data-utcoffset="1"></script><script>
 (function(h,o,t,j,a,r){
     h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
     h._hjSettings={hjid:3578286,hjsv:6};
     a=o.getElementsByTagName('head')[0];
     r=o.createElement('script');r.async=1;
     r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
     a.appendChild(r);
 })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">osrm.backend</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/osrm-backend.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-kotov/osrm.backend/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quick Start: Install OSRM and calculate routes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/e-kotov/osrm.backend/blob/main/vignettes/osrm-backend.Rmd" class="external-link"><code>vignettes/osrm-backend.Rmd</code></a></small>
      <div class="d-none name"><code>osrm-backend.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>eval <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-kotov/osrm.backend" class="external-link">osrm.backend</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/riatelab/osrm" class="external-link">osrm</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data: (c) OpenStreetMap contributors, ODbL 1.0 - http://www.openstreetmap.org/copyright</span></span></code></pre>
<pre><code><span><span class="co">## Routing: OSRM - http://project-osrm.org/</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span></code></pre>
<div class="section level2">
<h2 id="create-a-temporary-directory-and-copy-example-osm-pbf-file-into-it">Create a temporary directory and copy example OSM PBF file into
it<a class="anchor" aria-label="anchor" href="#create-a-temporary-directory-and-copy-example-osm-pbf-file-into-it"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">osrm_temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"osrm-data-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">osrm_temp_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">internal_pbf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/cur.osm.pbf"</span>, package <span class="op">=</span> <span class="st">"osrm.backend"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">internal_pbf</span>, to <span class="op">=</span> <span class="va">osrm_temp_dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="start-local-osrm-server">Start local OSRM server<a class="anchor" aria-label="anchor" href="#start-local-osrm-server"></a>
</h2>
<p>Start the server with <code><a href="../reference/osrm_start.html">osrm_start()</a></code> function pointing to
the temporary directory created above. It will automatically check if
OSRM Backend binaries are installed, and if not, it will install the
latest version, it will also automatically prepare the routing graph
from the OSM PBF file if not already done and start the server. If any
of the steps are unnecessary, it will skip them, so running this
funciton will not lead to re-downloading of OSRM binaries or
re-processing of the OSM PBF file if already done.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osrm_start.html">osrm_start</a></span><span class="op">(</span><span class="va">osrm_temp_dir</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Tip:</strong> You can check if server is running with
<code><a href="../reference/osrm_servers.html">osrm_servers()</a></code>:</p>
<pre><code># A tibble: 1 × 7
  id                                   pid  port algorithm started_at          alive has_handle
  &lt;chr&gt;                              &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dttm&gt;              &lt;lgl&gt; &lt;lgl&gt;
1 osrm-28034-5001-20251103122904.133 28034  5001 MLD       2025-11-03 00:00:00 TRUE  TRUE</code></pre>
<p>You can kill the server with <code><a href="../reference/osrm_stop.html">osrm_stop()</a></code> or
<code><a href="../reference/osrm_stop_all.html">osrm_stop_all()</a></code> if you have started several servers.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="load-spatial-data">Load spatial data<a class="anchor" aria-label="anchor" href="#load-spatial-data"></a>
</h2>
<p>Load some spatial data from the OSM PBF file to sample points for
routing and plot the street network:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read the pbf file with sf</span></span>
<span><span class="va">osm_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">internal_pbf</span>, layer <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span></span>
<span><span class="va">osm_streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">internal_pbf</span>, layer <span class="op">=</span> <span class="st">"multilinestrings"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">sampled_points</span> <span class="op">&lt;-</span> <span class="va">osm_points</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">osm_points</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculate-route-between-sampled-points">Calculate route between sampled points<a class="anchor" aria-label="anchor" href="#calculate-route-between-sampled-points"></a>
</h2>
<p>To use <a href="https://github.com/riatelab/osrm" class="external-link">osrm</a> package with the local server, you have to
set the <code>osrm.server</code> option to point to the local server
URL. The default port that <code><a href="../reference/osrm_start.html">osrm_start()</a></code> uses is
<code>5001</code>, so the URL will be
<code>http://localhost:5001/</code>. Then you can use any
<a href="https://github.com/riatelab/osrm" class="external-link">osrm</a> function as usual, here we calculate a route between
the two sampled points:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"osrm.server"</span> <span class="op">=</span> <span class="st">"http://localhost:5001/"</span><span class="op">)</span></span>
<span><span class="va">route</span> <span class="op">&lt;-</span> <span class="fu">osrm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/osrm/man/osrmRoute.html" class="external-link">osrmRoute</a></span><span class="op">(</span>loc <span class="op">=</span> <span class="va">sampled_points</span><span class="op">)</span></span>
<span><span class="va">route</span></span></code></pre></div>
<pre><code>Simple feature collection with 1 feature and 4 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -49.27156 ymin: -25.43082 xmax: -49.25396 ymax: -25.42358
Geodetic CRS:  WGS 84
          src dst duration distance                       geometry
3786_503 3786 503     5.55   2.6324 LINESTRING (-49.25534 -25.4...</code></pre>
</div>
<div class="section level2">
<h2 id="plot-the-route-on-top-of-the-street-network">Plot the route on top of the street network<a class="anchor" aria-label="anchor" href="#plot-the-route-on-top-of-the-street-network"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">osm_streets</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">route</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/example-route.png"></p>
</div>
<div class="section level2">
<h2 id="stop-local-osrm-server-and-cleanup">Stop local OSRM server and cleanup<a class="anchor" aria-label="anchor" href="#stop-local-osrm-server-and-cleanup"></a>
</h2>
<p>You can now stop the server:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osrm_stop.html">osrm_stop</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>Stopped OSRM server id=osrm-29557-5001-20251103124028.405 (pid 29557, port 5001).</code></pre>
<p>And remove the temporary directory:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">osrm_temp_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.ekotov.pro" class="external-link">Egor Kotov</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
